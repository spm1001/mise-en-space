{"id":"mise-02b","title":"Integration test with real account","description":"End-to-end test: search → fetch → read file. Uses test fixtures from V2.md.","design":"## Test Fixtures (from EXPERIMENTS.md)\n\n| Fixture | ID | Description |\n|---------|-----|-------------|\n| Doc: Simple | 1w8KcJtwlHcWn3HLlp9QVMQzmfVegW0lhVOd8K8kuLig | ROUNDTRIP_TEST |\n| Doc: Multi-tab | 1vqkOoNbPuc1MNolYZRhKvBONGZrrIopAb7bzYzn5x0k | Team Handbook |\n| Sheets | 1Hf2smDVDjBlxaZuGZvAJML5XmdFM-sPZW3xkCRfUfLY | Team meeting |\n| Gmail: Long thread | 194ac68f6091de54 | 72 messages |\n\n## Test Cases\n\n1. search(\"budget\") → returns Drive + Gmail results\n2. fetch(doc_id) → writes markdown, returns path\n3. fetch(sheet_id) → writes CSV, returns path\n4. fetch(thread_id) → writes cleaned text, returns path\n5. Read returned path → content is valid\n\n## Acceptance Criteria\n\n- [ ] All fixture types tested\n- [ ] Paths exist and readable\n- [ ] Content is valid markdown/CSV/text\n- [ ] No inline content in MCP response","status":"open","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:25:46.343318Z","created_by":"spm1001","updated_at":"2026-01-23T07:25:46.343318Z","dependencies":[{"issue_id":"mise-02b","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.972905Z","created_by":"spm1001"},{"issue_id":"mise-02b","depends_on_id":"mise-e0e","type":"blocks","created_at":"2026-01-23T07:26:19.898957Z","created_by":"spm1001"},{"issue_id":"mise-02b","depends_on_id":"mise-jvz","type":"blocks","created_at":"2026-01-23T07:26:19.979692Z","created_by":"spm1001"},{"issue_id":"mise-02b","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:04.93244Z","created_by":"spm1001"},{"issue_id":"mise-02b","depends_on_id":"mise-h6m","type":"blocks","created_at":"2026-01-24T20:18:15.076925Z","created_by":"spm1001"}]}
{"id":"mise-067","title":"Enable Claude to access browser dev tools directly","description":"Claude needs to sniff network requests autonomously, not via human-in-the-loop. Explore: webctl network intercept, Playwright request/response events, or Anthropic's claude-in-chrome extension.","design":"## Problem\n\nReverse-engineering private APIs requires inspecting network traffic. Currently:\n- User opens DevTools manually\n- User copies requests\n- Claude interprets\n- Slow, error-prone, breaks flow\n\n## Options\n\n1. **webctl enhancement**: Add `webctl intercept` command that captures requests/responses\n   - Playwright has `page.on('request')`, `page.on('response')`\n   - Could filter by URL pattern\n   - Return as JSON for Claude to parse\n\n2. **claude-in-chrome**: Anthropic's extension at ~/Repos/ (check if exists)\n   - May already have DevTools integration\n   - Native to Claude's ecosystem\n\n3. **Playwright directly**: Write a Python script that launches browser + intercepts\n   - More control, but heavier lift\n\n## Acceptance Criteria\n\n- [ ] Claude can autonomously capture network requests\n- [ ] Filter by URL pattern (e.g., \"timedtext\", \"gemini\")\n- [ ] Get request headers, payload, response body\n- [ ] No human copy-paste required","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T08:54:12.814936Z","created_by":"spm1001","updated_at":"2026-01-24T08:54:12.814936Z","dependencies":[{"issue_id":"mise-067","depends_on_id":"mise-jy3","type":"parent-child","created_at":"2026-01-24T20:17:31.293046Z","created_by":"spm1001"}]}
{"id":"mise-138","title":"Push to GitHub as mise-en-space","description":"Create GitHub repo, push initial scaffold. Currently local-only.","status":"tombstone","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-20T22:10:42.331554Z","created_by":"spm1001","updated_at":"2026-01-23T07:23:48.842511Z","deleted_at":"2026-01-23T07:23:48.842511Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mise-1k9","title":"Slides adapter: batch thumbnails","description":"Wire presentations().get() + batch pages().getThumbnail() to extractor and workspace. Use timing from scripts/slides_timing.py as reference.","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T17:31:15.20764Z","created_by":"spm1001","updated_at":"2026-01-23T18:04:15.647345Z","closed_at":"2026-01-23T18:04:15.647345Z","close_reason":"Redundant — covered by mise-g9i (Wire adapters) which specifies slides adapter with batch thumbnails"}
{"id":"mise-2bl","title":"Port slides extractor","description":"Port slides.py extraction (658 lines). Structured text + speaker notes, visual flags.","design":"## What to Port\n\nFrom v1 tools/slides.py:\n- Text extraction per slide\n- Speaker notes\n- Visual flags: [CHART], [IMAGE], [CONNECTOR], [SHAPE]\n- Detection: single_large_image, fragmented_text\n\n## NOT Porting (for now)\n\n- Thumbnail generation (~1s per thumbnail, bottleneck)\n- Can add later if needed\n- **When added: thumbnails MUST use batch API** — `new_batch_http_request()` for selected slides, not per-slide calls\n\n## Signature\n\nextract_slides(presentation_response: dict) -\u003e str\n\n## Acceptance Criteria\n\n- [ ] extractors/slides.py exists\n- [ ] Text + speaker notes extracted\n- [ ] Visual flags present\n- [ ] No thumbnail dependency\n- [ ] Unit test with fixture passes","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:24:35.46529Z","created_by":"spm1001","updated_at":"2026-01-23T17:26:59.130711Z","closed_at":"2026-01-23T17:26:59.130711Z","close_reason":"Slides extractor complete: title extraction, merged cells, groups, charts, speaker notes, warnings. 30 tests. Workspace manager with manifest.json. 160 total tests passing.","dependencies":[{"issue_id":"mise-2bl","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.317809Z","created_by":"spm1001"}]}
{"id":"mise-2h2","title":"Handle rowSpan in table parsing","description":"Slides tables can have merged cells with rowSpan \u003e 1. Currently only colSpan is handled. Without rowSpan handling, vertically merged cells produce silently wrong output — a 'silent killer' that corrupts data without warning.","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T17:31:16.750633Z","created_by":"spm1001","updated_at":"2026-01-24T22:06:37.079881Z","closed_at":"2026-01-24T22:06:37.079881Z","close_reason":"Fixed rowSpan handling in _parse_table(). Now tracks occupied columns from rowSpan cells and inserts empty placeholders in subsequent rows. Added test_rowspan_handled() test. Updated real_presentation.json fixture to include rowSpan test case.","dependencies":[{"issue_id":"mise-2h2","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T18:04:13.234957Z","created_by":"spm1001"},{"issue_id":"mise-2h2","depends_on_id":"mise-dyd","type":"parent-child","created_at":"2026-01-24T20:17:04.065089Z","created_by":"spm1001"},{"issue_id":"mise-2h2","depends_on_id":"mise-bx8","type":"blocks","created_at":"2026-01-24T20:18:14.625149Z","created_by":"spm1001"}]}
{"id":"mise-2jz","title":"Save sanitized real doc fixture","description":"User's test doc (1z-nQAcKlgortu22NbcL8ov9EfshWKabCFON3h-KYruQ) has linked slides, linked charts, linked tables, multiple tabs. Perfect test case. Sanitize and save as fixtures/docs/real_multi_tab.json for regression testing.","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T14:50:13.983104Z","created_by":"spm1001","updated_at":"2026-01-23T15:47:44.399211Z","closed_at":"2026-01-23T15:47:44.399211Z","close_reason":"Completed via different approach: captured real fixtures from 'Google Docs Test Suite' folder instead of specific doc. Built capture_fixtures.py and sanitize_fixtures.py scripts. 5 real fixtures captured (docs x2, sheets, slides, gmail)."}
{"id":"mise-356","title":"Port docs extractor","description":"Port docs.py extraction logic (661 lines). Handles multi-tab, footnotes, link merging.","design":"## What to Port\n\nFrom v1 tools/docs.py:\n- Multi-tab document handling\n- Footnote extraction\n- Hyperlink merging (adjacent runs)\n- Heading/list hierarchy\n- Table extraction\n\n## Signature\n\nextract_doc(doc_response: dict) -\u003e str\n\nInput: Raw Docs API documents.get() response\nOutput: Markdown string\n\n## Acceptance Criteria\n\n- [ ] extractors/docs.py exists\n- [ ] Handles multi-tab with === Tab: Name === separators\n- [ ] Preserves footnotes, links, tables\n- [ ] Unit test with fixture passes","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:24:20.419125Z","created_by":"spm1001","updated_at":"2026-01-23T13:15:19.926008Z","closed_at":"2026-01-23T13:15:19.926008Z","close_reason":"Ported docs extractor with multi-tab support, all tests pass (22 new tests)","dependencies":[{"issue_id":"mise-356","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.11587Z","created_by":"spm1001"}]}
{"id":"mise-3ab","title":"Wire create tool","description":"Create Google Doc/Sheet/Slides from markdown. Secondary priority.","design":"## Signature\n\ncreate(content: str, title: str, doc_type: str = 'doc', folder_id: str = None) -\u003e dict\n\n## Response Shape\n\n{\n  \"file_id\": \"...\",\n  \"url\": \"https://docs.google.com/...\",\n  \"title\": \"...\",\n  \"type\": \"doc|sheet|slides\"\n}\n\n## Current State\n\nserver.py:100 has:\n```python\n# TODO: Wire to tools/create.py\nreturn {\"status\": \"not_implemented\", \"title\": title}\n```\n\nNo tools/create.py exists yet.\n\n## Implementation Approach\n\n### 1. Drive Native Markdown Import (Docs)\n\nUse Drive's native markdown import (discovered via about.get):\n```python\nfile_metadata = {\n    'name': title,\n    'mimeType': 'application/vnd.google-apps.document',\n    'parents': [folder_id] if folder_id else []\n}\nmedia = MediaIoBaseUpload(\n    io.BytesIO(content.encode()),\n    mimetype='text/markdown'\n)\nfile = service.files().create(\n    body=file_metadata, \n    media_body=media,\n    fields='id,webViewLink'\n).execute()\n```\n\n### 2. Sheets from CSV/TSV\n\nFor doc_type='sheet':\n- Parse markdown tables → CSV\n- Upload with mimeType text/csv → converts to Sheet\n- Or: Create empty sheet, populate via Sheets API (more control)\n\n### 3. Slides from Markdown\n\nFor doc_type='slides':\n- Parse markdown headings as slides\n- Use Slides API to create presentation\n- Or: Create from template with placeholder replacement\n\n## File Structure\n\n```\ntools/\n  create.py         # Tool implementation\nadapters/\n  create.py         # Drive create operations (if needed)\n```\n\n## Acceptance Criteria\n\n- [ ] tools/create.py exists\n- [ ] server.py wires create() to tool\n- [ ] Creates Google Doc from markdown\n- [ ] Returns file_id and webViewLink\n- [ ] Optional folder_id parameter works\n- [ ] Error handling for invalid content\n- [ ] Integration test creates real doc","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:25:22.84022Z","created_by":"spm1001","updated_at":"2026-01-24T20:22:11.242796Z","closed_at":"2026-01-24T20:22:11.242796Z","close_reason":"Implemented create tool for Google Docs. tools/create.py with do_create(), wired to server.py, folder_id support, error handling, 5 integration tests all passing.","dependencies":[{"issue_id":"mise-3ab","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.781049Z","created_by":"spm1001"},{"issue_id":"mise-3ab","depends_on_id":"mise-g9i","type":"blocks","created_at":"2026-01-23T07:26:19.814894Z","created_by":"spm1001"},{"issue_id":"mise-3ab","depends_on_id":"mise-6ku","type":"parent-child","created_at":"2026-01-24T20:17:03.566589Z","created_by":"spm1001"}]}
{"id":"mise-3uu","title":"Confident deployability via comprehensive test coverage","description":"Testing infrastructure. Can refactor without fear, CI catches regressions, edge cases covered.","design":"## Success Criteria\n\n- [ ] Integration tests run against real account\n- [ ] Negative path tests cover malformed input\n- [ ] Adapter mocking infrastructure enables unit testing\n- [ ] Real fixtures captured and sanitized\n- [ ] Warning behaviors tested systematically\n- [ ] Retry decorator behavior verified\n\n## Execution Order\n\n1. **mise-h6m** Adapter mocking infrastructure (enables all other tests)\n2. **mise-02b** Integration test with real account (baseline)\n3. **mise-eqi** Add negative path tests (resilience)\n4. **mise-bl9** Round-trip extractor tests with real fixtures\n5. **mise-5kj** Sanitized test fixtures\n6. **mise-679** Capture linked-content doc fixture\n7. **mise-8g5** Test warning behaviors systematically\n8. **mise-52d.1** Test retry decorator\n9. **mise-qa6** Test hybrid PDF threshold logic\n10. **mise-e5o** Create pre-exfil test fixture\n\n## Why This Matters\n\nWithout tests, every change is a gamble. With comprehensive coverage, can ship with confidence. Mocking infrastructure is the foundation.","status":"open","priority":2,"issue_type":"epic","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:16:45.38323Z","created_by":"spm1001","updated_at":"2026-01-24T20:16:45.38323Z"}
{"id":"mise-4h4","title":"Extraction logic is testable and maintainable","description":"Architecture quality. Adapters are pure, can be unit tested without API calls. DRY, clean separation.","design":"## Success Criteria\n\n- [ ] PDF extraction in adapters/pdf.py (not fetch.py)\n- [ ] Office extraction in adapters/office.py (not fetch.py)\n- [ ] Shared Drive conversion logic factored out\n- [ ] Retry decorator has no duplication\n- [ ] Each adapter testable with mocked responses\n\n## Execution Order\n\n1. **mise-k6g** Factor PDF extraction into adapter\n2. **mise-gtg** Factor Office extraction into adapter\n   (These share Drive conversion - do together, factor shared code)\n3. **mise-v79** Refactor retry decorator duplication\n\n## Why This Matters\n\nHardcoded logic in tools layer = untestable. Can't verify PDF threshold logic without calling real APIs. Clean adapters = confident refactoring.","status":"closed","priority":2,"issue_type":"epic","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:16:35.215186Z","created_by":"spm1001","updated_at":"2026-01-24T20:34:40.814005Z","closed_at":"2026-01-24T20:34:40.814005Z","close_reason":"All children complete: PDF adapter (mise-k6g), Office adapter (mise-gtg), retry refactor closed as won't-do (mise-v79). Extraction logic now testable and maintainable."}
{"id":"mise-52d","title":"mise-en-space MVP — search + fetch that works","description":"Opinionated Google Workspace MCP with 4 verbs: search, fetch, create, help. Filesystem-first, token-efficient, ergonomic for Claude.","design":"## Core Opinions\n\n1. **4 verbs** — search, fetch, create, help (not 17 tools)\n2. **Filesystem-first** — fetch returns path, Claude reads with standard tools\n3. **Auto-detect IDs** — Gmail/Drive IDs detected, URLs converted\n4. **Always LLM-analysis** — no purpose parameter, always markdown/CSV\n5. **Internal batching** — Gmail batch API under the hood\n6. **Pre-exfil detection** — check \"Email Attachments\" folder first\n\n## Architecture\n\n```\nextractors/   Pure functions (API response → content)\nadapters/     Thin Google API wrappers\ntools/        MCP tool definitions\nworkspace/    File deposit management\n```\n\n## Acceptance Criteria\n\n- [ ] search(query, sources) returns metadata for Drive + Gmail\n- [ ] fetch(id) deposits file, returns path\n- [ ] create(content, title) makes Google Doc from markdown\n- [ ] help() self-documents\n- [ ] Pre-exfiltrated attachments detected and used\n- [ ] Can replace v1 in claude.json","status":"closed","priority":1,"issue_type":"epic","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:24:03.211479Z","created_by":"spm1001","updated_at":"2026-01-24T20:18:20.726508Z","closed_at":"2026-01-24T20:18:20.726508Z","close_reason":"Replaced with focused Desired Outcome epics: mise-6ku, mise-dyd, mise-4h4, mise-3uu, mise-jy3"}
{"id":"mise-52d.1","title":"Test retry decorator","description":"Zero coverage on core infrastructure. Write tests for _get_http_status, _should_retry, _convert_to_mise_error, and the decorator itself with both sync and async functions.","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T09:03:34.812391Z","created_by":"spm1001","updated_at":"2026-01-23T09:03:34.812391Z","dependencies":[{"issue_id":"mise-52d.1","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T09:03:34.813148Z","created_by":"spm1001"},{"issue_id":"mise-52d.1","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:05.700486Z","created_by":"spm1001"}]}
{"id":"mise-52d.2","title":"Add Makefile with check target","description":"make check runs pytest + mypy in one command. Consolidates quality gates.","status":"open","priority":3,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T09:03:46.345057Z","created_by":"spm1001","updated_at":"2026-01-23T09:03:46.345057Z","dependencies":[{"issue_id":"mise-52d.2","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T09:03:46.345658Z","created_by":"spm1001"},{"issue_id":"mise-52d.2","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:31.506042Z","created_by":"spm1001"}]}
{"id":"mise-52d.3","title":"Add search_threads to gmail adapter","description":"Gmail adapter has fetch_thread and fetch_message but no search. Needed for mise-e0e (Wire search tool).","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T21:59:43.543047Z","created_by":"spm1001","updated_at":"2026-01-23T22:10:53.876656Z","closed_at":"2026-01-23T22:10:53.876656Z","close_reason":"Added search_threads to gmail adapter with batch metadata fetch. 3 integration tests passing.","dependencies":[{"issue_id":"mise-52d.3","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T21:59:43.543652Z","created_by":"spm1001"}]}
{"id":"mise-52d.4","title":"Pre-exfil attachment detection","description":"When fetching Gmail threads with attachments, check Drive's 'Email Attachments' folder first. Use Drive copy if found (already indexed by fullText search).","design":"## Why\n\nDrive indexes PDF content via fullText. Gmail doesn't search inside attachments.\nBackground extractor saves attachments to Drive → they become searchable.\nFetch should use the indexed copy when available.\n\n## Approach\n\n1. Config for Email Attachments folder ID (env var or discover by name)\n2. When processing Gmail attachment, query Drive:\n   `'{folder_id}' in parents and name = '{filename}'`\n3. If found, return Drive file_id instead of downloading from Gmail\n4. If not found, fall back to Gmail attachment download\n\n## Edge cases\n\n- Duplicate filenames (same name, different emails) — may need date matching\n- Stale copies (attachment updated, Drive copy old) — probably rare\n- Folder doesn't exist — graceful fallback\n\n## Acceptance Criteria\n\n- [ ] Looks up attachments in configured Drive folder\n- [ ] Uses Drive copy when found\n- [ ] Falls back to Gmail when not found\n- [ ] Works when folder not configured (skip lookup)","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T22:20:19.27301Z","created_by":"spm1001","updated_at":"2026-01-23T22:20:19.27301Z","dependencies":[{"issue_id":"mise-52d.4","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T22:20:19.274147Z","created_by":"spm1001"},{"issue_id":"mise-52d.4","depends_on_id":"mise-jy3","type":"parent-child","created_at":"2026-01-24T20:17:06.341654Z","created_by":"spm1001"}]}
{"id":"mise-52d.5","title":"Support PDF files in fetch","description":"fetch() should handle PDF files using markitdown for text extraction. Drive conversion doesn't help here (PDFs stay as PDFs).","design":"## Approach\n\n1. Detect PDF MIME type in fetch_drive()\n2. Download file via Drive API\n3. Run through markitdown\n4. Deposit as markdown\n\n## Reference\n\nmarkitdown chosen over PyMuPDF: MIT licensed vs AGPL.\n\n## Acceptance Criteria\n\n- [ ] PDF files extract to markdown via markitdown\n- [ ] Handle multi-page PDFs\n- [ ] Graceful fallback for scanned/image PDFs\n- [ ] Integration test with real PDF","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T23:08:29.79669Z","created_by":"spm1001","updated_at":"2026-01-24T17:11:55.843775Z","closed_at":"2026-01-24T17:11:55.843775Z","close_reason":"Implemented PDF support via markitdown. Downloads from Drive, extracts text, deposits as markdown. Graceful fallback for scanned/image PDFs with warning. 2 new unit tests (184 total).","dependencies":[{"issue_id":"mise-52d.5","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T23:08:29.797292Z","created_by":"spm1001"}]}
{"id":"mise-52d.6","title":"Selective thumbnail fetching for slides","description":"Port v1's selective thumbnail logic. Skip stock photos and text-only slides. Reduces 43-slide deck from 20s to ~5s.","design":"## Problem\n\nSequential thumbnail API calls: ~0.5s each (unavoidable, batch disabled).\n43-slide deck = 20+ seconds blocking.\n\n## v1 Logic (mcp-google-workspace)\n\nLocation: workspace_mcp/tools/slides.py lines 209-239, 562-589\n\nSkip thumbnails when:\n- single_large_image: \u003e50% slide coverage = stock photo\n- text_only: No images, just text shapes\n- empty: No content\n\nOnly thumbnail:\n- Charts, diagrams\n- Fragmented layouts (multiple images/shapes)\n- Complex visual content\n\n## Approach\n\n1. Analyze slide content before fetching thumbnails\n2. Classify each slide: needs_thumbnail | skip\n3. Only fetch for needs_thumbnail slides\n4. Include skip reason in manifest\n\n## Acceptance Criteria\n\n- [ ] Classify slides by visual complexity\n- [ ] Skip single_large_image slides\n- [ ] Skip text_only slides\n- [ ] Manifest shows which slides were skipped and why\n- [ ] Timing improvement measurable (scripts/slides_timing.py)","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T23:08:42.923276Z","created_by":"spm1001","updated_at":"2026-01-24T22:21:48.938603Z","closed_at":"2026-01-24T22:21:48.938603Z","close_reason":"Ported v1 selective thumbnail logic. Skips stock photos and text-only slides. 4 of 7 test slides now get thumbnails.","dependencies":[{"issue_id":"mise-52d.6","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T23:08:42.92391Z","created_by":"spm1001"},{"issue_id":"mise-52d.6","depends_on_id":"mise-jy3","type":"parent-child","created_at":"2026-01-24T20:17:06.21288Z","created_by":"spm1001"},{"issue_id":"mise-52d.6","depends_on_id":"mise-q7j","type":"blocks","created_at":"2026-01-24T20:18:15.25134Z","created_by":"spm1001"}]}
{"id":"mise-52d.7","title":"Support Office files in fetch (DOCX, XLSX, PPTX)","description":"fetch() should handle Office files using Drive API conversion (not markitdown). Bakeoff showed Drive conversion is 29% smaller and cleaner.","design":"## Approach\n\n1. Detect Office MIME types in fetch_drive()\n2. Use Drive API export to convert:\n   - DOCX → text/markdown or text/plain\n   - XLSX → text/csv\n   - PPTX → text/plain (or markdown if available)\n3. Deposit converted content\n\n## Why Drive conversion?\n\nBakeoff (Jan 2026): Drive conversion beats markitdown for Office files.\n- 29% smaller output\n- Cleaner formatting\n- No external dependency\n\n## Acceptance Criteria\n\n- [ ] DOCX files convert via Drive API\n- [ ] XLSX files convert to CSV\n- [ ] PPTX files convert to text\n- [ ] Integration test for each type","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T10:50:23.340289Z","created_by":"spm1001","updated_at":"2026-01-24T17:24:43.904977Z","closed_at":"2026-01-24T17:24:43.904977Z","close_reason":"Implemented Office file support (DOCX/XLSX/PPTX) via Drive conversion. Download → upload with conversion → export → delete temp. Much cleaner than markitdown (160x smaller for XLSX). All three types tested with real files.","dependencies":[{"issue_id":"mise-52d.7","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T10:50:23.340926Z","created_by":"spm1001"}]}
{"id":"mise-52d.8","title":"Support video/audio summaries in fetch","description":"fetch() should return Google's pre-computed AI summaries for video/audio files, rather than just the raw file. Leverages GenAI API discovered via reverse engineering.","design":"## Approach\n\nUse Google's internal GenAI API (appsgenaiserver-pa.clients6.google.com) to get:\n- AI-generated summary\n- Transcript snippets\n- Suggested prompts\n\n## Reference\n\nFull implementation: ~/Repos/skill-chrome-log/references/DRIVE_VIDEO_SUMMARY_HOWTO.md\n\n## Open Questions\n\n1. **SAPISID cookie**: The API requires browser cookies, not OAuth tokens.\n   Options: webctl, manual, or find alternative auth path.\n\n2. **timedtext endpoint**: Separate /timedtext?fmt=json3 endpoint exists for\n   raw transcripts. May not be needed if summary API returns transcript snippets.\n\n## Acceptance Criteria\n\n- [ ] Solve SAPISID authentication problem\n- [ ] Call GenAI streamGenerate endpoint\n- [ ] Extract summary text from streaming response\n- [ ] Deposit summary + transcript to mise-fetch/\n- [ ] Handle videos without summaries gracefully","notes":"COMPLETED (2026-01-24):\n- Created adapters/cdp.py - CDP cookie fetching via websockets\n- Created adapters/genai.py - GenAI video summary API client\n- Updated tools/fetch.py - routes video/audio to new handler\n- Tested with real video - AI summary extracted successfully\n\nKEY DECISION: Requires chrome-debug on port 9222. Falls back gracefully with\n\"run chrome-debug to enable summaries\" hint when CDP not available.\n\nOPEN QUESTIONS resolved:\n- SAPISID: Get all cookies via CDP Network.getCookies, not just SAPISID\n- timedtext: Not needed - summary API returns transcript snippets","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T10:50:24.743143Z","created_by":"spm1001","updated_at":"2026-01-24T11:18:30.527307Z","closed_at":"2026-01-24T11:18:30.527307Z","close_reason":"Implemented video/audio summary support. CDP adapter for cookies, GenAI adapter for summaries, fetch routing for media files. Falls back gracefully when chrome-debug unavailable.","dependencies":[{"issue_id":"mise-52d.8","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T10:50:24.743773Z","created_by":"spm1001"}]}
{"id":"mise-5kj","title":"Sanitized test fixtures","description":"Test fixtures contain real data (ITV budget figures, email addresses). Create sanitized versions with fake data that preserves structure. Required before open-sourcing or sharing.","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T18:04:02.022456Z","created_by":"spm1001","updated_at":"2026-01-23T18:04:02.022456Z","dependencies":[{"issue_id":"mise-5kj","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T18:04:13.00914Z","created_by":"spm1001"},{"issue_id":"mise-5kj","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:05.314889Z","created_by":"spm1001"}]}
{"id":"mise-626","title":"Verify linked-content fixture has edge cases","description":"Doc 1bREiVmvgSsRKJLjamTOE0Wasq1ze7R3bIPOdtJMomKM should contain linked slides, linked charts, linked tables. Fetch it and confirm the edge cases exist before relying on it for testing. URL from user: https://docs.google.com/document/d/1bREiVmvgSsRKJLjamTOE0Wasq1ze7R3bIPOdtJMomKM","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T18:07:57.340642Z","created_by":"spm1001","updated_at":"2026-01-23T18:07:57.340642Z","dependencies":[{"issue_id":"mise-626","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:31.405534Z","created_by":"spm1001"}]}
{"id":"mise-679","title":"Capture linked-content doc fixture","description":"Capture fixture from https://docs.google.com/document/d/1bREiVmvgSsRKJLjamTOE0Wasq1ze7R3bIPOdtJMomKM — contains linked slides, linked charts, linked tables. Test that extractor handles linkedContentReference edge cases correctly.","design":"## Approach\n\n1. Verify the doc still exists and has linked content\n2. Add to TEST_IDS in capture_fixtures.py\n3. Capture as fixtures/docs/real_linked_content.json\n4. Add test that verifies linked chart/slide placeholders appear\n\n## Why this matters\nCurrent real_multi_tab.json may not have linked content. The docs extractor has special handling for linkedContentReference that needs real-world testing.","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T15:49:05.83736Z","created_by":"spm1001","updated_at":"2026-01-23T18:03:54.290545Z","dependencies":[{"issue_id":"mise-679","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T18:04:13.159527Z","created_by":"spm1001"},{"issue_id":"mise-679","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:05.444215Z","created_by":"spm1001"}]}
{"id":"mise-6bo","title":"Workspace manager — file deposit","description":"Manages ~/.mcp-workspace/ folder structure. Creates paths, cleans temp, returns paths.","design":"## Structure\n\n~/.mcp-workspace/\n├── [account@domain.com]/\n│   ├── drive/{fileId}.md\n│   ├── gmail/{threadId}.txt\n│   └── attachments/\n└── temp/  (auto-cleanup on startup)\n\n## Functions\n\nworkspace/manager.py:\n- get_account_folder(account) -\u003e Path\n- get_file_path(account, source, id, ext) -\u003e Path\n- write_content(path, content) -\u003e Path\n- cleanup_temp()\n- init() — called on server start\n\n## Acceptance Criteria\n\n- [ ] Creates folder structure on first use\n- [ ] Returns paths (never content)\n- [ ] Cleans temp/ on startup\n- [ ] Handles multiple accounts (future-proof)","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:24:52.622867Z","created_by":"spm1001","updated_at":"2026-01-23T22:28:29.949174Z","closed_at":"2026-01-23T22:28:29.949174Z","close_reason":"Workspace manager already complete. Removed speculative cleanup_old_deposits. 22 unit tests passing.","dependencies":[{"issue_id":"mise-6bo","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.503264Z","created_by":"spm1001"}]}
{"id":"mise-6ku","title":"Claude can search, fetch, AND create across all Workspace content","description":"Complete the MCP tool surface. All 3 verbs (search, fetch, create) work across all content types (Drive, Gmail, Contacts).","design":"## Success Criteria\n\n- [ ] `search(source=\"drive\")` returns file metadata\n- [ ] `search(source=\"gmail\")` returns thread metadata  \n- [ ] `search(source=\"contacts\")` returns people\n- [ ] `fetch(file_id)` works for all supported types\n- [ ] `create(content, type=\"doc\")` creates Google Doc\n- [ ] `create(content, type=\"sheet\")` creates Google Sheet\n- [ ] MCP resources expose capabilities documentation\n\n## Execution Order\n\n1. **mise-3ab** Wire create tool (highest value gap)\n2. **mise-bmk** Implement contacts search (completes search)\n3. **mise-tld** Wire resources (self-documenting)\n\n## Why This Matters\n\nWithout create, Claude can only read. With all 3 verbs, Claude becomes a full Workspace participant — can research, synthesize, AND produce artifacts.","status":"open","priority":1,"issue_type":"epic","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:16:18.445658Z","created_by":"spm1001","updated_at":"2026-01-24T20:16:18.445658Z"}
{"id":"mise-6zd","title":"Fix silent thumbnail failures in slides adapter","description":"Slides adapter silently swallows all thumbnail fetch exceptions. Missing thumbnails not reported to user.","design":"## Problem\n\nIn adapters/slides.py `_fetch_thumbnails()`:\n```python\nexcept Exception:\n    pass  # Silent failure - line 112\n```\n\nWhen a thumbnail fails to fetch:\n- No warning added to result\n- No logging\n- User doesn't know slide N is missing\n- Manifest shows has_thumbnails=true even with gaps\n\n## Impact\n\n- Debugging is hard (why is slide 7 missing?)\n- User may think extraction succeeded fully\n- Inconsistent with other extractors (which populate warnings)\n\n## Approach\n\n1. Catch specific exceptions:\n   - HttpError 403: permission denied\n   - HttpError 404: thumbnail not available\n   - Timeout: slow network\n   \n2. Populate warnings for failures:\n   ```python\n   warnings.append(f\"Slide {i}: thumbnail unavailable ({error_type})\")\n   ```\n\n3. Track failed slides in manifest:\n   ```json\n   {\n     \"has_thumbnails\": true,\n     \"thumbnail_failures\": [7, 12]\n   }\n   ```\n\n4. Consider retry for transient failures (already have retry decorator)\n\n## Acceptance Criteria\n\n- [ ] Thumbnail failures logged with reason\n- [ ] warnings list populated for failed slides\n- [ ] Manifest includes thumbnail_failures array\n- [ ] Test with mock that simulates failure\n- [ ] Pass is replaced with explicit handling","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:09:32.338581Z","created_by":"spm1001","updated_at":"2026-01-25T15:25:55.720724Z","closed_at":"2026-01-25T15:25:55.720724Z","close_reason":"Fixed silent thumbnail failures: added warning aggregation, better HTTP error messages, download failure tracking, thumbnail_failures in manifest, comprehensive tests","dependencies":[{"issue_id":"mise-6zd","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:10:46.471219Z","created_by":"spm1001"},{"issue_id":"mise-6zd","depends_on_id":"mise-dyd","type":"parent-child","created_at":"2026-01-24T20:17:04.177683Z","created_by":"spm1001"},{"issue_id":"mise-6zd","depends_on_id":"mise-2h2","type":"blocks","created_at":"2026-01-24T20:18:14.719097Z","created_by":"spm1001"}]}
{"id":"mise-8g5","title":"Test warning behaviors systematically","description":"Warnings implementation lacks dedicated tests. Need coverage for: empty sheets trigger warning, unknown element types trigger warning, HTML conversion fallback triggers warning, truncation triggers warning. Currently behavior exists but is undertested.","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T18:07:56.044601Z","created_by":"spm1001","updated_at":"2026-01-23T18:07:56.044601Z","dependencies":[{"issue_id":"mise-8g5","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:11:38.301688Z","created_by":"spm1001"},{"issue_id":"mise-8g5","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:05.568977Z","created_by":"spm1001"}]}
{"id":"mise-8v5","title":"Find Gemini video summary API endpoint","description":"The Gemini side panel in Drive shows AI summaries of videos — more useful than raw transcript. Need to find the API endpoint that powers this.","design":"## Context\n\nThe transcript (/timedtext) is raw ASR output. The Gemini summary is processed/distilled — includes:\n- Summary of key points\n- Action items\n- Key topics\n\n## Approach\n\n1. Open video in Drive with Gemini panel visible\n2. Use network intercept to capture requests when panel loads\n3. Look for endpoints containing: gemini, gen_lang, ent-assist, aiplatform\n4. The summary might be streamed (chunked response)\n\n## Why This Matters\n\nFor a sous-chef MCP, the summary is much more valuable than transcript:\n- Token-efficient (distilled, not verbatim)\n- Structured (topics, actions)\n- LLM-ready","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T08:54:00.309936Z","created_by":"spm1001","updated_at":"2026-01-24T11:18:20.078483Z","closed_at":"2026-01-24T11:18:20.078483Z","close_reason":"Research complete - GenAI API discovered and documented in skill-chrome-log/references/DRIVE_VIDEO_SUMMARY_HOWTO.md. Implementation done in mise-52d.8."}
{"id":"mise-9az","title":"Test infrastructure: sanitized fixtures + adapter mocking","description":"Integration tests use real MIT budget data and hit real APIs. Need: (1) sanitized test fixtures with fake data, (2) mocking infrastructure so adapter unit tests don't need real credentials/APIs.","design":"## Problem\n\n1. **Real data in fixtures** — test spreadsheet contains actual MIT budget data. If repo goes public or fixtures are shared, data leaks.\n\n2. **No mocking** — adapter tests hit real APIs. Slow, quota-consuming, fragile (test spreadsheet could be deleted).\n\n## Approach\n\n### Sanitized Fixtures\n- Create fake spreadsheet data that exercises same edge cases (multi-tab, special chars, empty cells)\n- Store as JSON in fixtures/sheets/\n- Consider: should integration tests use fixtures or real API? Maybe both (unit uses fixtures, integration uses real)\n\n### Adapter Mocking\n- Mock the Google API service objects\n- Adapters receive mock service, return canned responses\n- Unit tests: fast, no credentials needed\n- Integration tests: real API, needs credentials\n\n## Questions to Resolve\n- Where do mocks live? `tests/mocks/`?\n- Do we use pytest fixtures or a mocking library (unittest.mock, responses)?\n- Should adapters accept service as parameter (dependency injection) for easier mocking?\n\n## Acceptance Criteria\n- [ ] No real company data in committed fixtures\n- [ ] Adapter unit tests run without credentials\n- [ ] Integration tests still work with real API\n- [ ] Clear separation: unit (mocked) vs integration (real)","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T12:27:46.778517Z","created_by":"spm1001","updated_at":"2026-01-23T18:04:14.690475Z","closed_at":"2026-01-23T18:04:14.690475Z","close_reason":"Split into mise-5kj (sanitized fixtures) and mise-h6m (adapter mocking)"}
{"id":"mise-9jl","title":"Deposit folder cleanup strategy","description":"mise-fetch/ folders accumulate over time with no cleanup. Need TTL-based or manual cleanup.","design":"## Problem\n\nEvery fetch creates a folder in mise-fetch/:\n```\nmise-fetch/\n├── slides--deck-1--abc123/\n├── doc--notes--def456/\n├── ...hundreds more over time\n```\n\nNo cleanup = unbounded growth.\n\n## Options\n\n### Option A: TTL-based auto-cleanup\n```python\ndef cleanup_old_deposits(max_age_days: int = 7):\n    \"\"\"Delete deposits older than N days.\"\"\"\n```\n\nPros: Automatic, no user action\nCons: May delete something user wants\n\n### Option B: Manual cleanup command\n```bash\n# MCP tool\nmise cleanup --older-than 7d\n\n# Or expose in manifest\n\"cleanup_hint\": \"safe to delete after 2026-01-31\"\n```\n\nPros: User controls\nCons: Requires user action\n\n### Option C: Versioned deposits\n```\nmise-fetch/\n├── slides--deck-1--abc123--20260124T1200/\n├── slides--deck-1--abc123--20260125T0900/\n```\n\nPros: History preserved\nCons: Even more growth\n\n## Recommendation\n\nStart with Option B (manual) + manifest hint:\n1. Add `cleanup_after` timestamp to manifest.json\n2. Document cleanup approach\n3. Consider auto-cleanup later based on usage\n\n## Acceptance Criteria\n\n- [ ] manifest.json includes cleanup_after field\n- [ ] workspace/manager.py has cleanup function\n- [ ] Documentation explains cleanup\n- [ ] Test cleanup with mock deposits","status":"open","priority":3,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:10:12.905212Z","created_by":"spm1001","updated_at":"2026-01-24T20:10:12.905212Z","dependencies":[{"issue_id":"mise-9jl","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:10:46.768247Z","created_by":"spm1001"},{"issue_id":"mise-9jl","depends_on_id":"mise-jy3","type":"parent-child","created_at":"2026-01-24T20:17:06.466552Z","created_by":"spm1001"}]}
{"id":"mise-bl9","title":"Round-trip extractor tests with real fixtures","description":"Test that extractors produce expected content from real API fixtures, not just 'does it crash' smoke tests. Should verify known content appears in output.","design":"## Approach\n\nFor each real fixture, add tests that check specific expected content:\n- real_multi_tab.json → verify tab titles, some known text appears\n- real_spreadsheet.json → verify cell values round-trip\n- real_gmail.json → verify message bodies extracted, signatures stripped\n\nThis catches regressions where extractor 'works' but produces wrong output.","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T15:48:54.268436Z","created_by":"spm1001","updated_at":"2026-01-23T15:48:54.268436Z","dependencies":[{"issue_id":"mise-bl9","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:11:38.390695Z","created_by":"spm1001"},{"issue_id":"mise-bl9","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:05.187872Z","created_by":"spm1001"}]}
{"id":"mise-bmk","title":"Implement contacts search","description":"Search tool returns 'Contacts search not yet implemented' for source='contacts'. Complete the search surface.","design":"## Current State\n\nIn tools/search.py:79-80:\n```python\nelif source == \"contacts\":\n    return {\"error\": True, \"message\": \"Contacts search not yet implemented\"}\n```\n\nPeople API utilities exist in v1 (mcp-google-workspace) but not wired here.\n\n## Scope\n\n1. Add contacts adapter\n2. Define ContactResult model\n3. Wire to search tool\n4. Test with real contacts\n\n## Approach\n\n### 1. Model (models.py)\n\n```python\n@dataclass\nclass ContactResult:\n    resource_name: str  # people/c123...\n    display_name: str\n    email_addresses: list[str]\n    phone_numbers: list[str]\n    organization: str | None\n    job_title: str | None\n    source: Literal[\"directory\", \"contacts\"]\n```\n\n### 2. Adapter (adapters/contacts.py)\n\n```python\ndef search_contacts(query: str, max_results: int = 10) -\u003e list[ContactResult]:\n    \"\"\"\n    Search BOTH organization directory AND personal contacts.\n    \n    - Directory: searchDirectoryPeople (requires directory.readonly)\n    - Contacts: searchContacts (requires contacts.readonly)\n    \"\"\"\n```\n\nPort from v1's lookup_contact() which already handles both sources.\n\n### 3. Wire to search.py\n\n```python\nelif source == \"contacts\":\n    results = search_contacts(query, max_results)\n    return [r.to_dict() for r in results]\n```\n\n## Acceptance Criteria\n\n- [ ] ContactResult model defined\n- [ ] adapters/contacts.py with search function\n- [ ] search(source=\"contacts\") returns results\n- [ ] Searches both directory and personal contacts\n- [ ] Integration test with real contacts","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:09:44.378821Z","created_by":"spm1001","updated_at":"2026-01-24T20:09:44.378821Z","dependencies":[{"issue_id":"mise-bmk","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:10:46.569856Z","created_by":"spm1001"},{"issue_id":"mise-bmk","depends_on_id":"mise-6ku","type":"parent-child","created_at":"2026-01-24T20:17:03.691329Z","created_by":"spm1001"}]}
{"id":"mise-br7","title":"Replace v1 in claude.json","description":"Swap mcp-google-workspace for mise-en-space in Claude config. Final ship step.","design":"## Steps\n\n1. Update ~/.claude.json mcpServers entry\n2. Point to mise-en-space server.py\n3. Test with real Claude session\n4. Verify search + fetch workflow works\n\n## Rollback\n\nKeep v1 config commented, easy to revert if issues.\n\n## Acceptance Criteria\n\n- [ ] mise-en-space registered in claude.json\n- [ ] Claude can call search, fetch, create, help\n- [ ] Real workflow tested (find doc, fetch, read)","status":"open","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:25:54.786555Z","created_by":"spm1001","updated_at":"2026-01-23T07:25:54.786555Z","dependencies":[{"issue_id":"mise-br7","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:07.063273Z","created_by":"spm1001"},{"issue_id":"mise-br7","depends_on_id":"mise-02b","type":"blocks","created_at":"2026-01-23T07:26:20.063198Z","created_by":"spm1001"},{"issue_id":"mise-br7","depends_on_id":"mise-6ku","type":"parent-child","created_at":"2026-01-24T20:17:31.186832Z","created_by":"spm1001"},{"issue_id":"mise-br7","depends_on_id":"mise-3ab","type":"blocks","created_at":"2026-01-24T20:18:14.526629Z","created_by":"spm1001"}]}
{"id":"mise-bx8","title":"Escape search query input","description":"Search queries passed directly to Drive/Gmail APIs without escaping. Security risk and correctness issue.","design":"## Problem\n\nIn tools/search.py:\n```python\nquery = f\"fullText contains '{query}'\"  # line 61\n```\n\nUser input with quotes breaks the query or could inject malicious Drive query operators.\n\n## Scope\n\n1. Drive search - fullText contains clause\n2. Gmail search - query passed directly\n3. Contacts search (when implemented)\n\n## Approach\n\n1. Create `validation.py:escape_drive_query(query: str) -\u003e str`\n   - Escape single quotes: `'` → `\\'`\n   - Escape backslashes: `\\` → `\\\\`\n   \n2. Create `validation.py:validate_gmail_query(query: str) -\u003e str`\n   - Validate against known Gmail operators\n   - Reject/escape dangerous patterns\n   \n3. Update search.py to use these functions\n\n4. Add tests with malicious inputs:\n   - Quotes: `test' OR name contains 'secret`\n   - Operators: `mimeType:application/pdf`\n   - Unicode edge cases\n\n## Acceptance Criteria\n\n- [ ] Drive queries with quotes don't break\n- [ ] Gmail queries with special chars handled\n- [ ] Tests cover injection attempts\n- [ ] No user input reaches API unescaped","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:08:51.56354Z","created_by":"spm1001","updated_at":"2026-01-24T21:55:52.70237Z","closed_at":"2026-01-24T21:55:52.70237Z","close_reason":"Added escape_drive_query() and sanitize_gmail_query() to validation.py. Updated search.py to escape Drive queries and sanitize Gmail queries. 15 new tests cover injection attempts. Audit confirms no other unescaped user input paths — IDs/titles/content all passed as structured data, not interpolated into query strings.","dependencies":[{"issue_id":"mise-bx8","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:08:56.646131Z","created_by":"spm1001"},{"issue_id":"mise-bx8","depends_on_id":"mise-dyd","type":"parent-child","created_at":"2026-01-24T20:17:03.94728Z","created_by":"spm1001"}]}
{"id":"mise-chf","title":"Port sheets extractor — prove the pattern","description":"Simplest extractor (138 lines). Port to pure function to validate architecture.","design":"## Why First\n\n- 138 lines, single function\n- Clear input → output\n- If this works, others follow same pattern\n\n## Porting Steps\n\n1. Copy extraction logic from v1 tools/sheets.py\n2. Remove get_sheets_service() call\n3. Change signature: extract_sheets(response: dict) -\u003e str\n4. Add type hints\n5. Write unit test with fixture\n\n## Acceptance Criteria\n\n- [ ] extractors/sheets.py exists with pure function\n- [ ] Unit test with mocked API response passes\n- [ ] No imports from adapters or tools","notes":"COMPLETED: Pure function extract_sheets_content() with typed SpreadsheetData input. 13 unit tests covering CSV escaping edge cases. Architecture test enforces no adapter/tool imports. Used to validate the extractor pattern before porting docs/gmail/slides.","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:24:11.833893Z","created_by":"spm1001","updated_at":"2026-01-23T09:02:58.595204Z","closed_at":"2026-01-23T07:34:27.980862Z","close_reason":"Ported sheets extractor: pure function extract_sheets_content() with CSV escaping, 13 unit tests passing, no adapter/tool coupling","dependencies":[{"issue_id":"mise-chf","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.017733Z","created_by":"spm1001"}]}
{"id":"mise-da6","title":"Fix sheets adapter to use batchGet","description":"Current sheets adapter makes N+1 API calls (1 metadata + N tabs). Should use values().batchGet() to fetch all tabs in one call.","design":"## Current (N+1 calls)\n\n```python\nfor sheet_name in sheet_names:\n    values_response = service.spreadsheets().values().get(\n        spreadsheetId=spreadsheet_id,\n        range=f\"'{sheet_name}'\",\n    ).execute()\n```\n\n## Should Be (2 calls)\n\n```python\nranges = [f\"'{name}'\" for name in sheet_names]\nbatch_response = service.spreadsheets().values().batchGet(\n    spreadsheetId=spreadsheet_id,\n    ranges=ranges,\n    valueRenderOption=\"FORMATTED_VALUE\",\n).execute()\n```\n\n## Acceptance Criteria\n\n- [ ] Uses batchGet instead of per-tab get\n- [ ] Integration test still passes\n- [ ] Quota usage reduced (verify with rate limit test)","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T12:11:05.193664Z","created_by":"spm1001","updated_at":"2026-01-23T12:12:01.497189Z","closed_at":"2026-01-23T12:12:01.497189Z","close_reason":"Fixed immediately - switched to batchGet in same session"}
{"id":"mise-dyd","title":"mise-en-space handles edge cases and errors gracefully","description":"Robustness and security. No silent failures, no injection vectors, warnings surfaced to user.","design":"## Success Criteria\n\n- [ ] Search queries with quotes/special chars don't break or inject\n- [ ] Thumbnail fetch failures reported (not silently swallowed)\n- [ ] Table rowSpan handled correctly\n- [ ] Temp files cleaned up (or cleanup documented)\n- [ ] All warnings flow through to manifest.json\n\n## Execution Order\n\n1. **mise-bx8** Escape search query input (security - do first)\n2. **mise-2h2** Handle rowSpan in table parsing (correctness)\n3. **mise-6zd** Fix silent thumbnail failures (observability)\n4. **mise-mii** Handle orphaned temp files (cleanup)\n\n## Why This Matters\n\nSilent failures erode trust. Claude thinks extraction succeeded when it didn't. Security issues (query injection) could expose data. Robustness = reliability.","status":"open","priority":1,"issue_type":"epic","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:16:26.882981Z","created_by":"spm1001","updated_at":"2026-01-24T20:16:26.882981Z"}
{"id":"mise-e0e","title":"Wire search tool","description":"Unified search across Drive + Gmail. Returns metadata only, no files written.","design":"## Signature\n\nsearch(query: str, sources: list[str] = ['drive', 'gmail'], max_results: int = 20) -\u003e dict\n\n## Response Shape\n\n{\n  \"drive_results\": [\n    {\"id\": \"...\", \"name\": \"...\", \"mimeType\": \"...\", \"modified\": \"...\", \"url\": \"...\"}\n  ],\n  \"gmail_results\": [\n    {\"thread_id\": \"...\", \"subject\": \"...\", \"snippet\": \"...\", \"date\": \"...\", \"from\": \"...\"}\n  ]\n}\n\n## Key Behaviors\n\n- Separate lists per source (not merged)\n- Drive: fullText match IS the triage (no snippets needed)\n- Gmail: snippet from API\n- Includes exfiltrated attachments (they're in Drive)\n- Contacts deferred for now\n\n## URL Handling\n\nAccept Gmail URLs, convert to thread ID:\nhttps://mail.google.com/mail/u/0/#inbox/18f4a... → thread_id\n\n## Acceptance Criteria\n\n- [ ] Searches Drive and Gmail in parallel\n- [ ] Returns separate result lists\n- [ ] Handles Gmail URLs\n- [ ] max_results works per source","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:25:02.686984Z","created_by":"spm1001","updated_at":"2026-01-23T22:13:09.483681Z","closed_at":"2026-01-23T22:13:09.483681Z","close_reason":"Search tool wired. Drive+Gmail parallel search, 6 integration tests, result formatting. 160 unit + 32 integration tests all passing.","dependencies":[{"issue_id":"mise-e0e","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.59552Z","created_by":"spm1001"},{"issue_id":"mise-e0e","depends_on_id":"mise-g9i","type":"blocks","created_at":"2026-01-23T07:26:19.242041Z","created_by":"spm1001"}]}
{"id":"mise-e5o","title":"Create pre-exfil test fixture","description":"Email with attachment that's been exfiltrated to Drive. Needed to test pre-exfil detection.","design":"## What's Needed\n\n1. Find an email with attachment in user's Gmail\n2. Verify the attachment exists in \"Email Attachments\" folder\n3. Note: email thread ID, attachment filename, Drive file ID\n4. Add to EXPERIMENTS.md fixtures table\n\n## Test Case\n\nfetch(attachment_id) should:\n1. Detect pre-exfiltrated version exists\n2. Fetch from Drive (not Gmail)\n3. Return path to Drive-sourced file","status":"open","priority":3,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:30:06.326602Z","created_by":"spm1001","updated_at":"2026-01-23T07:30:06.326602Z","dependencies":[{"issue_id":"mise-e5o","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:30:15.885771Z","created_by":"spm1001"},{"issue_id":"mise-e5o","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:05.962226Z","created_by":"spm1001"}]}
{"id":"mise-eqi","title":"Add negative path tests","description":"No tests for malformed input, missing fields, or error conditions. Extractors need resilience testing.","design":"## Problem\n\nCurrent tests only cover happy paths:\n- Valid fixtures → expected output\n- No tests for: null fields, missing objectId, empty content, malformed structures\n\n## Gap Analysis\n\n### Extractors\n\n| Extractor | Missing Tests |\n|-----------|---------------|\n| docs.py | Missing inlineObject reference, null textRun content |\n| sheets.py | Empty spreadsheet, null cell values, malformed rows |\n| slides.py | Missing objectId, null shape content, empty tables |\n| gmail.py | Decode errors, missing body parts, malformed MIME |\n\n### Adapters\n\n| Adapter | Missing Tests |\n|---------|---------------|\n| All | 429 rate limit response |\n| All | 5xx server error |\n| All | Network timeout |\n| All | Invalid credentials (401) |\n\n### Validation\n\n| Function | Missing Tests |\n|----------|---------------|\n| extract_drive_file_id | Malformed URLs, empty string |\n| extract_gmail_id | Invalid web IDs, empty string |\n| convert_gmail_web_id | Edge case IDs |\n\n## Approach\n\n1. Create fixtures/malformed/ directory with bad inputs\n2. Test each extractor with malformed data\n3. Verify graceful degradation (warnings, not crashes)\n4. Test adapters with mocked error responses (see mise-h6m)\n\n## Acceptance Criteria\n\n- [ ] fixtures/malformed/ contains edge case fixtures\n- [ ] Each extractor has negative path tests\n- [ ] Extractors produce warnings not exceptions for recoverable errors\n- [ ] Tests document expected behavior for each error type","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:10:39.234734Z","created_by":"spm1001","updated_at":"2026-01-24T20:10:39.234734Z","dependencies":[{"issue_id":"mise-eqi","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:10:46.967413Z","created_by":"spm1001"},{"issue_id":"mise-eqi","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:05.061308Z","created_by":"spm1001"},{"issue_id":"mise-eqi","depends_on_id":"mise-h6m","type":"blocks","created_at":"2026-01-24T20:18:15.164488Z","created_by":"spm1001"}]}
{"id":"mise-g9i","title":"Wire adapters — Google API wrappers","description":"Thin wrappers that call Google APIs and pass responses to extractors. Thread-safe.","design":"## Pattern\n\nFrom V2.md research:\n- Use requestBuilder pattern for thread safety\n- Always use fields parameter for partial responses\n- **BATCH API CALLS** — whenever making multiple calls of the same type, batch them\n\n## Batching Requirements (MANDATORY)\n\n| Adapter | What to batch | How |\n|---------|---------------|-----|\n| sheets | Multiple tabs | `values().batchGet(ranges=[...])` |\n| gmail | Multiple messages in thread | `new_batch_http_request()` |\n| slides | Selected thumbnail fetches | `new_batch_http_request()` |\n| drive | Multiple file metadata | `new_batch_http_request()` |\n| docs | Inline image fetches | `new_batch_http_request()` if multiple |\n\n## Adapters Needed\n\nadapters/drive.py:\n- get_file_metadata(file_id)\n- export_file(file_id, mime_type) \n- search_files(query, max_results)\n\nadapters/gmail.py:\n- get_thread(thread_id) — batch fetches all messages\n- get_message(message_id)\n- search_threads(query, max_results)\n\nadapters/docs.py:\n- get_document(doc_id)\n\nadapters/sheets.py:\n- get_spreadsheet(spreadsheet_id) — uses batchGet for tabs\n\nadapters/slides.py:\n- get_presentation(presentation_id)\n- get_thumbnails(presentation_id, slide_ids) — batched\n\n## Acceptance Criteria\n\n- [ ] All adapters use fields parameter\n- [ ] All adapters use batch APIs where applicable (see table above)\n- [ ] Gmail uses batch endpoint internally\n- [ ] Sheets uses batchGet for multiple tabs\n- [ ] Thread-safe (requestBuilder pattern)\n- [ ] Integration test with real API passes","notes":"## Learnings from docs extractor (Jan 2026)\n\nCRITICAL: inlineObjects is per-tab, not per-document\n- Multi-tab docs: documentTab.inlineObjects (each tab has its own)\n- Model must have inline_objects on DocTab, not DocData\n\nElement taxonomy (from discovery doc):\n- ParagraphElement types: textRun, footnoteReference, inlineObjectElement, horizontalRule, pageBreak, columnBreak, equation, autoText, person, richLink, dateElement\n- EmbeddedObject types: imageProperties, embeddedDrawingProperties, linkedContentReference\n\nlinkedContentReference gap:\n- Charts: sheetsChartReference populated with spreadsheetId + chartId\n- Slides: linkedContentReference is empty {} — API doesn't expose source presentation\n- This is a missing feature, not broken code\n\nSheets benchmark (2 calls vs 1):\n- includeGridData=True: 5.3s, 44MB payload (formatting metadata)\n- get() + batchGet(): 1.5s, 79KB payload\n- 2 calls wins by 3.5x speed, 560x smaller","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:24:44.671222Z","created_by":"spm1001","updated_at":"2026-01-23T18:32:00.02925Z","closed_at":"2026-01-23T18:32:00.02925Z","close_reason":"All adapters wired: docs, slides, gmail, drive. 23 integration tests passing. Batch thumbnails not supported by Slides API (501), using sequential with URL download instead.","dependencies":[{"issue_id":"mise-g9i","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.41232Z","created_by":"spm1001"}]}
{"id":"mise-g9i.1","title":"Write sheets adapter","description":"First real adapter. Calls Sheets API, assembles SpreadsheetData, proves end-to-end pattern. Use @with_retry decorator. Follow search_/fetch_/create_ naming.","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T09:03:40.499314Z","created_by":"spm1001","updated_at":"2026-01-23T11:35:00.401404Z","closed_at":"2026-01-23T11:35:00.401404Z","close_reason":"Sheets adapter working: fetch_spreadsheet calls API, assembles SpreadsheetData, passes integration tests (3/4, 4th hit rate limit). Retry decorator and error conversion also verified.","dependencies":[{"issue_id":"mise-g9i.1","depends_on_id":"mise-g9i","type":"parent-child","created_at":"2026-01-23T09:03:40.500194Z","created_by":"spm1001"}]}
{"id":"mise-gtg","title":"Factor Office file extraction into adapter","description":"DOCX/XLSX/PPTX extraction via Drive conversion is hardcoded in fetch.py. Should be adapter for testability.","design":"## Current State\n\nIn tools/fetch.py:\n- `fetch_office()` handles DOCX, XLSX, PPTX\n- Uses upload → convert → export → delete pattern\n- Creates `_mise_temp_{file_id}` files in Drive\n\n## Problem\n\n1. Not testable without Drive access\n2. Pattern duplicates PDF's Drive conversion logic\n3. Temp file cleanup is best-effort (orphans accumulate)\n\n## Approach\n\nCreate `adapters/office.py`:\n\n```python\n@dataclass\nclass OfficeExtractionResult:\n    content: str\n    source_type: Literal[\"docx\", \"xlsx\", \"pptx\"]\n    converted_type: Literal[\"doc\", \"sheet\", \"slides\"]\n    warnings: list[str]\n\ndef extract_office_content(\n    file_path: Path,\n    service: Resource,\n    source_mime: str\n) -\u003e OfficeExtractionResult:\n    \"\"\"\n    Extract Office file via Drive conversion.\n    \n    1. Upload to Drive with conversion\n    2. Export as text/markdown\n    3. Delete temp file (best effort)\n    \"\"\"\n```\n\n## Shared Infrastructure\n\nBoth PDF and Office use Drive conversion. Consider:\n- `adapters/drive_conversion.py` for shared upload/convert/export/delete\n- Used by both pdf.py and office.py\n\n## Acceptance Criteria\n\n- [ ] adapters/office.py exists with typed interface\n- [ ] fetch.py imports from adapter\n- [ ] Shared conversion logic factored out\n- [ ] Unit tests with mocked Drive responses\n- [ ] Temp file cleanup properly logged/warned","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:09:22.044973Z","created_by":"spm1001","updated_at":"2026-01-24T20:28:57.425329Z","closed_at":"2026-01-24T20:28:57.425329Z","close_reason":"Office extraction factored into adapters/office.py. Uses shared adapters/conversion.py for Drive upload→convert→export→delete pattern.","dependencies":[{"issue_id":"mise-gtg","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:10:46.375813Z","created_by":"spm1001"},{"issue_id":"mise-gtg","depends_on_id":"mise-4h4","type":"parent-child","created_at":"2026-01-24T20:17:04.534153Z","created_by":"spm1001"}]}
{"id":"mise-h6m","title":"Adapter mocking infrastructure","description":"Adapter tests currently need real Google credentials. Add mocking infrastructure so tests run without hitting real APIs. Enables CI, faster tests, no credential management.","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T18:04:03.309992Z","created_by":"spm1001","updated_at":"2026-01-25T15:49:18.642701Z","closed_at":"2026-01-25T15:49:18.642701Z","close_reason":"Added adapter mocking infrastructure: make_http_error helper, mock service fixtures, patch fixtures. Refactored slides adapter tests to use shared infrastructure.","dependencies":[{"issue_id":"mise-h6m","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T18:04:13.084171Z","created_by":"spm1001"},{"issue_id":"mise-h6m","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:04.802103Z","created_by":"spm1001"}]}
{"id":"mise-hnq","title":"Add capture_slides_fixture.py script","description":"Consistent fixture capture workflow for slides, matching capture_fixtures.py pattern. Should fetch presentation and optionally sanitize.","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T17:31:18.063965Z","created_by":"spm1001","updated_at":"2026-01-23T18:04:16.594043Z","closed_at":"2026-01-23T18:04:16.594043Z","close_reason":"Redundant — scripts/capture_fixtures.py already handles slides"}
{"id":"mise-i93","title":"Reverse-engineer Drive video transcript API","description":"The /timedtext endpoint returns ASR transcripts in json3 format. Need to figure out: (1) Drive file ID → internal video ID mapping, (2) how authpayload is generated, (3) the redirect flow that establishes the session.","design":"## Discovery (Jan 2026)\n\nEndpoint: `https://drive.google.com/u/0/timedtext?id={vid}\u0026fmt=json3`\n\nSee: `bakeoff/video_transcript_discovery.md`\n\n## Approach\n\n1. Use webctl or Playwright to intercept network requests\n2. Trace the redirect chain (302 → 200)\n3. Find where authpayload comes from\n4. Test if Drive API exposes internal video ID\n\n## Alternative: claude-in-chrome\n\nThe Anthropic claude-in-chrome extension might provide dev tools access more naturally than webctl.","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T08:53:49.194025Z","created_by":"spm1001","updated_at":"2026-01-24T11:18:24.906334Z","closed_at":"2026-01-24T11:18:24.906334Z","close_reason":"Not needed - GenAI summary API returns transcript snippets. Separate timedtext endpoint exists but summary is sufficient for LLM consumption."}
{"id":"mise-jvz","title":"Wire fetch tool — with pre-exfil detection","description":"Fetch content to filesystem. Auto-detects ID type, checks for pre-exfiltrated attachments.","design":"## Signature\n\nfetch(id: str) -\u003e dict\n\n## Response Shape\n\n{\n  \"path\": \"~/.mcp-workspace/account/drive/abc123.md\",\n  \"format\": \"markdown\",\n  \"metadata\": {\"title\": \"...\", \"mimeType\": \"...\", \"modified\": \"...\"}\n}\n\n## ID Auto-Detection\n\n1. If looks like Gmail URL → extract thread ID\n2. If looks like Drive URL → extract file ID\n3. If hex-ish (194ac68f...) → Gmail thread/message\n4. Otherwise → Drive file ID\n\n## Pre-Exfiltration Detection\n\nBefore downloading Gmail attachment:\n1. Check \"Email Attachments\" folder for matching file\n2. Match by: filename + size + approximate date\n3. If found → fetch from Drive (already indexed, searchable)\n4. If not → download from Gmail (3x faster than Drive for same binary)\n\n## Routing by Type\n\n- Google Doc → docs extractor → markdown\n- Google Sheet → sheets extractor → CSV  \n- Google Slides → slides extractor → structured text\n- Gmail thread → gmail extractor → cleaned text\n- PDF → markitdown → markdown\n- Office → Drive conversion → appropriate extractor\n- Binary → download to workspace, return path\n\n## Acceptance Criteria\n\n- [ ] Auto-detects ID type\n- [ ] Handles Gmail URLs\n- [ ] Checks pre-exfil folder before Gmail download\n- [ ] Routes to correct extractor\n- [ ] Returns path, not content\n\n## URL Handling (REQUIRED)\n\nAccept Gmail URLs and convert to thread ID:\n- https://mail.google.com/mail/u/0/#inbox/18f4a... → extract thread_id\n- Port the URL extraction logic from v1 validation.py\n","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:25:15.084528Z","created_by":"spm1001","updated_at":"2026-01-23T22:33:09.699182Z","closed_at":"2026-01-23T22:33:09.699182Z","close_reason":"Fetch tool wired. ID auto-detection (URL/Gmail/Drive), routes by mimeType, deposits to mise-fetch/ with manifests. 7 integration tests, 160 unit + 39 integration total.","dependencies":[{"issue_id":"mise-jvz","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.688019Z","created_by":"spm1001"},{"issue_id":"mise-jvz","depends_on_id":"mise-g9i","type":"blocks","created_at":"2026-01-23T07:26:19.325008Z","created_by":"spm1001"},{"issue_id":"mise-jvz","depends_on_id":"mise-6bo","type":"blocks","created_at":"2026-01-23T07:26:19.405759Z","created_by":"spm1001"},{"issue_id":"mise-jvz","depends_on_id":"mise-chf","type":"blocks","created_at":"2026-01-23T07:26:19.487758Z","created_by":"spm1001"},{"issue_id":"mise-jvz","depends_on_id":"mise-356","type":"blocks","created_at":"2026-01-23T07:26:19.568328Z","created_by":"spm1001"},{"issue_id":"mise-jvz","depends_on_id":"mise-nfh","type":"blocks","created_at":"2026-01-23T07:26:19.649579Z","created_by":"spm1001"},{"issue_id":"mise-jvz","depends_on_id":"mise-2bl","type":"blocks","created_at":"2026-01-23T07:26:19.732148Z","created_by":"spm1001"}]}
{"id":"mise-jy3","title":"mise-en-space extracts richer context than v1","description":"Enhancements. Visual content (thumbnails, images) available when useful. Smarter extraction.","design":"## Success Criteria\n\n- [ ] Decision made on v1 PDF thumbnail porting\n- [ ] Selective thumbnail fetching available (skip when not needed)\n- [ ] Pre-exfil attachment detection working\n- [ ] Deposit cleanup strategy implemented\n\n## Execution Order\n\n1. **mise-q7j** Evaluate v1 PDF thumbnail extraction (research first)\n2. **mise-52d.6** Selective thumbnail fetching for slides\n3. **mise-52d.4** Pre-exfil attachment detection\n4. **mise-9jl** Deposit folder cleanup strategy\n\n## Why This Matters\n\nv1 had features we may want. Selective thumbnails = faster for text-only use cases. Pre-exfil = leverage user's existing Drive indexing. These make mise-en-space genuinely better, not just cleaner.","status":"open","priority":3,"issue_type":"epic","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:16:53.534947Z","created_by":"spm1001","updated_at":"2026-01-24T20:16:53.534947Z"}
{"id":"mise-k6g","title":"Factor PDF extraction into adapter","description":"PDF hybrid extraction logic (markitdown → Drive fallback) is hardcoded in fetch.py. Should be an adapter for testability and reuse.","design":"## Current State\n\nIn tools/fetch.py:\n- `fetch_pdf()` function handles all PDF logic\n- MARKITDOWN_MIN_CHARS = 500 hardcoded constant\n- Hybrid strategy: try markitdown, fall back to Drive if \u003c500 chars\n\n## Problem\n\n1. Not testable without real files (no adapter abstraction)\n2. Threshold not parameterized\n3. Logic entangled with file writing (workspace concerns)\n\n## Approach\n\nCreate `adapters/pdf.py`:\n\n```python\n@dataclass\nclass PdfExtractionResult:\n    content: str\n    method: Literal[\"markitdown\", \"drive\"]\n    char_count: int\n    warnings: list[str]\n\ndef extract_pdf_content(\n    file_path: Path | None = None,\n    file_id: str | None = None,\n    service: Resource | None = None,\n    min_chars_threshold: int = 500\n) -\u003e PdfExtractionResult:\n    \"\"\"\n    Hybrid PDF extraction.\n    \n    If file_path provided: use markitdown directly\n    If file_id provided: download then markitdown, fall back to Drive conversion\n    \"\"\"\n```\n\nMove from fetch.py:\n- `_extract_with_markitdown()` \n- `_extract_with_drive_conversion()`\n- Threshold constant\n\n## Acceptance Criteria\n\n- [ ] adapters/pdf.py exists with typed interface\n- [ ] fetch.py imports from adapter (thin wiring only)\n- [ ] min_chars_threshold is parameterized\n- [ ] Unit tests with mocked markitdown responses\n- [ ] Integration test with real PDF","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:09:12.256743Z","created_by":"spm1001","updated_at":"2026-01-24T20:28:57.330853Z","closed_at":"2026-01-24T20:28:57.330853Z","close_reason":"PDF extraction factored into adapters/pdf.py. Hybrid strategy (markitdown→Drive fallback) with parameterized threshold. 6 unit tests.","dependencies":[{"issue_id":"mise-k6g","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:10:46.277418Z","created_by":"spm1001"},{"issue_id":"mise-k6g","depends_on_id":"mise-4h4","type":"parent-child","created_at":"2026-01-24T20:17:04.41514Z","created_by":"spm1001"}]}
{"id":"mise-k97","title":"Investigate Google Groups content access","description":"Research how to fetch Google Groups conversation archives. Individual Gmail inboxes aren't reliable (subscriptions vary, digest mode, membership changes). Need to access group archives directly.","design":"## Goal\n\nEnable `fetch(group_id)` or `search(source=\"groups\")` to access Google Groups discussions.\n\n## Research Questions\n\n1. **Groups Migration API** — Can it read/export posts without admin?\n   - Docs: https://developers.google.com/admin-sdk/groups-migration\n   - Test: Try to list/export from a group we have access to\n\n2. **groups.google.com scraping** — What's the DOM structure?\n   - Auth: Does browser session (webctl) work?\n   - Pagination: How are threads listed?\n   - Content: Can we get full thread content?\n\n3. **Cloud Identity API** — Any content access?\n   - Docs: https://cloud.google.com/identity/docs/groups\n\n4. **Workspace admin approaches** — What's possible with elevated access?\n\n## Acceptance Criteria\n\n- [ ] Document which API/approach works (or confirm none do)\n- [ ] If viable: create follow-up bead with implementation design\n- [ ] If not viable: document why and close\n\n## Test Groups\n\n- MIT team groups (if accessible)\n- Public Google Groups (for unauthenticated testing)","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:40:48.224167Z","created_by":"spm1001","updated_at":"2026-01-24T21:27:09.680923Z","closed_at":"2026-01-24T21:27:09.680923Z","close_reason":"Research complete: No viable API for Google Groups content. Groups Migration API is write-only. Takeout is admin-blocked. Web scraping works but is impractically slow (~3s per topic). Recommendation: Request Vault export from IT, or accept Groups as unsupported content type.","dependencies":[{"issue_id":"mise-k97","depends_on_id":"mise-6ku","type":"parent-child","created_at":"2026-01-24T20:40:53.598789Z","created_by":"spm1001"}]}
{"id":"mise-mii","title":"Handle orphaned _mise_temp_* files","description":"If Drive delete fails during PDF/Office conversion, orphan temp files accumulate. Options: (1) Catch delete errors and log for manual cleanup, (2) Add cleanup job that finds _mise_temp_* files older than 1 hour, (3) Use Drive's trash instead of permanent delete.","status":"closed","priority":3,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T19:56:14.172851Z","created_by":"spm1001","updated_at":"2026-01-25T15:46:57.651295Z","closed_at":"2026-01-25T15:46:57.651295Z","close_reason":"Already addressed: delete failures caught, logged, and surfaced as warnings. _mise_temp_ prefix enables manual cleanup. Additional automation is YAGNI.","dependencies":[{"issue_id":"mise-mii","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:11:38.485239Z","created_by":"spm1001"},{"issue_id":"mise-mii","depends_on_id":"mise-dyd","type":"parent-child","created_at":"2026-01-24T20:17:04.296598Z","created_by":"spm1001"},{"issue_id":"mise-mii","depends_on_id":"mise-6zd","type":"blocks","created_at":"2026-01-24T20:18:14.808777Z","created_by":"spm1001"}]}
{"id":"mise-mkb","title":"Wire help tool — self-documentation","description":"Self-documentation tool. Returns usage info for the MCP.","design":"## Signature\n\nhelp(topic: str = None) -\u003e str\n\n## Topics\n\n- None → overview of all verbs\n- \"search\" → search usage and examples\n- \"fetch\" → fetch usage, format routing\n- \"create\" → create usage\n- \"formats\" → what formats are supported\n\n## Acceptance Criteria\n\n- [ ] Default help is concise overview\n- [ ] Topic-specific help exists for each verb\n- [ ] Examples included","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:25:30.899606Z","created_by":"spm1001","updated_at":"2026-01-23T07:43:25.311309Z","closed_at":"2026-01-23T07:43:25.311309Z","close_reason":"Superseded: documentation via MCP Resources instead of help tool. 3 verbs not 4.","dependencies":[{"issue_id":"mise-mkb","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.883329Z","created_by":"spm1001"}]}
{"id":"mise-nfh","title":"Port gmail extractor","description":"Port gmail.py extraction (1126 lines). Signature stripping, HTML→markdown, thread assembly.","design":"## What to Port\n\nFrom v1 tools/gmail.py:\n- Signature stripping (talon library, 0.01ms per message)\n- HTML → markdown (markitdown, NOT Google Docs API)\n- Thread assembly from messages\n- Quoted reply removal\n\n## Key Learning (from V2.md)\n\nHTML→markdown was the bottleneck (10s for 64KB email).\nNow using markitdown: ~100ms. Keep this fix.\n\n## Signature\n\nextract_thread(thread_response: dict, messages: list[dict]) -\u003e str\nextract_message(message_response: dict) -\u003e str\n\n## Acceptance Criteria\n\n- [ ] extractors/gmail.py exists\n- [ ] Signature stripping works\n- [ ] HTML converted via markitdown (fast path)\n- [ ] Unit test with fixture passes","status":"closed","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:24:28.743738Z","created_by":"spm1001","updated_at":"2026-01-23T15:22:31.74465Z","closed_at":"2026-01-23T15:22:31.74465Z","close_reason":"Ported gmail extractor with signature stripping (talon), HTML→markdown (markitdown), drive link extraction, thread assembly. 31 unit tests passing.","dependencies":[{"issue_id":"mise-nfh","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:06.224214Z","created_by":"spm1001"}]}
{"id":"mise-ogf","title":"PDF visual extraction strategy","description":"Decide when PDFs need page images vs text extraction. Unlike Slides, PDFs don't have semantic markers (charts, shapes). Options: always text, always images, hybrid based on text density, user parameter.","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T22:24:12.022384Z","created_by":"spm1001","updated_at":"2026-01-24T22:24:12.022384Z"}
{"id":"mise-p01","title":"Port sheets.py — prove the pattern","description":"Smallest extractor (138 lines, 1 function). Port to pure function to validate architecture.","design":"## Why sheets.py First\n\n- 138 lines, single function `read_sheets_as_csv()`\n- Clear input → output\n- If this works, docs.py/slides.py/gmail.py follow same pattern\n\n## Porting Steps\n\n1. Copy extraction logic from v1 tools/sheets.py\n2. Remove `get_sheets_service()` call\n3. Change signature: `extract_sheets_csv(sheets_response: dict) -\u003e str`\n4. Write unit test with fixture\n5. Write integration test with real sheet\n\n## Acceptance Criteria\n\n- [ ] extractors/sheets.py exists\n- [ ] Pure function signature\n- [ ] Unit test passes\n- [ ] Integration test passes","status":"tombstone","priority":1,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-20T22:10:34.217867Z","created_by":"spm1001","updated_at":"2026-01-23T07:23:48.772683Z","deleted_at":"2026-01-23T07:23:48.772683Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mise-q7j","title":"Evaluate v1 PDF thumbnail extraction","description":"v1 (mcp-google-workspace) surfaces thumbnails as well as markdown for PDFs. Evaluate whether to port this logic.","design":"## Context\n\nUser requested evaluation of v1's PDF handling which includes thumbnails, not just text extraction.\n\n## v1 Behavior (to investigate)\n\nNeed to check mcp-google-workspace for:\n1. How does v1 extract PDF thumbnails?\n2. What API/library does it use?\n3. Are these page thumbnails or embedded images?\n4. What's the quality/performance tradeoff?\n\n## Questions to Answer\n\n1. **Value**: Do PDF thumbnails add value for Claude's analysis?\n   - Charts/graphs embedded in PDFs\n   - Scanned documents with images\n   - Presentations exported to PDF\n\n2. **Feasibility**: What does extraction require?\n   - PyMuPDF (AGPL license - problematic)\n   - pdf2image + poppler (MIT, but heavy dependency)\n   - Drive thumbnail API (if available for PDFs?)\n   \n3. **Consistency**: Should PDFs match slides behavior?\n   - Slides: content.md + slide_*.png\n   - PDFs: content.md + page_*.png?\n\n4. **Cost**: Performance impact?\n   - Thumbnail generation time\n   - Storage overhead\n   - Token cost for Claude to analyze images\n\n## Research Tasks\n\n- [ ] Read v1's PDF handling code\n- [ ] Test v1 on sample PDFs\n- [ ] Compare output: v1 vs mise-en-space\n- [ ] Benchmark performance difference\n- [ ] Assess license implications\n\n## Decision Outcome\n\nAfter research, create follow-up bead:\n- If YES: \"Port v1 PDF thumbnail extraction\" with implementation plan\n- If NO: Close with rationale documented\n\n## Acceptance Criteria\n\n- [ ] v1 PDF code reviewed\n- [ ] Sample PDFs tested in both systems\n- [ ] Comparison documented (quality, speed, deps)\n- [ ] Decision made and rationale captured\n- [ ] Follow-up bead created OR this closed with \"won't do\"","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:09:59.884865Z","created_by":"spm1001","updated_at":"2026-01-24T20:09:59.884865Z","dependencies":[{"issue_id":"mise-q7j","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:10:46.665619Z","created_by":"spm1001"},{"issue_id":"mise-q7j","depends_on_id":"mise-jy3","type":"parent-child","created_at":"2026-01-24T20:17:06.087452Z","created_by":"spm1001"}]}
{"id":"mise-qa6","title":"Test hybrid PDF threshold logic","description":"Unit test for the \u003c500 char fallback in fetch_pdf. Test cases: (1) markitdown returns 600 chars → no fallback, (2) markitdown returns 100 chars → Drive fallback triggered. Mock both paths.","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T19:56:12.495317Z","created_by":"spm1001","updated_at":"2026-01-24T19:56:12.495317Z","dependencies":[{"issue_id":"mise-qa6","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:11:38.203182Z","created_by":"spm1001"},{"issue_id":"mise-qa6","depends_on_id":"mise-3uu","type":"parent-child","created_at":"2026-01-24T20:17:05.839947Z","created_by":"spm1001"}]}
{"id":"mise-r0a","title":"Extract V2.md into decisions summary","description":"V2.md is 466 lines of research. Extract key decisions into a digestible table format.","design":"## Target Format\n\n| Topic | Decision | Rationale | Source |\n|-------|----------|-----------|--------|\n| Gmail HTML→MD | markitdown | 100ms vs 10s (Google Docs API) | V2.md Gmail section |\n| PDF extraction | PyMuPDF primary | 35x faster, AGPL acceptable for personal | V2.md PDF section |\n| ... | ... | ... | ... |\n\n## Location\n\nAdd to CLAUDE.md or create docs/DECISIONS.md\n\n## Why\n\nFuture Claude needs decisions quickly, not 466 lines of exploration.","status":"open","priority":3,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:30:15.795777Z","created_by":"spm1001","updated_at":"2026-01-23T07:30:15.795777Z","dependencies":[{"issue_id":"mise-r0a","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:30:20.987895Z","created_by":"spm1001"}]}
{"id":"mise-tld","title":"Wire resources — self-documenting capabilities","description":"MCP resources that expose dynamic API info: import/export formats, quotas, patterns.","design":"## From v1\n\nworkspace://capabilities/drive/import-formats  → What can be imported\nworkspace://capabilities/drive/export-formats  → What can be exported\nworkspace://quotas/drive/storage               → User's storage limits\nworkspace://patterns/...                       → Usage patterns\n\n## Why Useful\n\nClaude can read these to discover what's possible without external docs.\nDynamic = fetched from actual API (about.get), not static.\n\n## Simpler for v2?\n\nCould consolidate into fewer resources:\n- workspace://capabilities → all format info\n- workspace://help/{topic} → patterns + usage\n\nOr just rely on help() tool and skip resources.\n\n## Acceptance Criteria\n\n- [ ] Decide: resources vs expanded help() tool\n- [ ] If resources: wire import/export formats\n- [ ] Dynamic content from API (not static)","status":"open","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T07:26:49.012371Z","created_by":"spm1001","updated_at":"2026-01-23T07:26:49.012371Z","dependencies":[{"issue_id":"mise-tld","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-23T07:26:54.128785Z","created_by":"spm1001"},{"issue_id":"mise-tld","depends_on_id":"mise-6ku","type":"parent-child","created_at":"2026-01-24T20:17:03.829691Z","created_by":"spm1001"}]}
{"id":"mise-v79","title":"Refactor retry decorator duplication","description":"async_wrapper and sync_wrapper in retry.py are nearly identical. DRY violation.","design":"## Problem\n\nIn retry.py lines 143-204:\n- `async_wrapper()` (lines 143-174)\n- `sync_wrapper()` (lines 177-204)\n\nBoth have identical:\n- Retry loop structure\n- Exponential backoff calculation\n- Jitter application\n- Exception handling logic\n\nOnly difference: `await func(...)` vs `func(...)`\n\n## Approach\n\nExtract common logic into helper:\n\n```python\ndef _calculate_delay(attempt: int, delay_ms: int, jitter_ms: int) -\u003e float:\n    \"\"\"Calculate delay with exponential backoff and jitter.\"\"\"\n    base = delay_ms * (2 ** attempt) / 1000\n    jitter = random.uniform(0, jitter_ms / 1000)\n    return base + jitter\n\ndef _should_retry(exception: Exception, retryable_errors: tuple) -\u003e bool:\n    \"\"\"Determine if exception is retryable.\"\"\"\n    # Check HTTP status codes, error types, etc.\n```\n\nThen both wrappers become thin:\n```python\nasync def async_wrapper(*args, **kwargs):\n    for attempt in range(max_attempts):\n        try:\n            return await func(*args, **kwargs)\n        except retryable_errors as e:\n            if not _should_retry(e, retryable_errors):\n                raise\n            delay = _calculate_delay(attempt, delay_ms, jitter_ms)\n            await asyncio.sleep(delay)\n    raise\n```\n\n## Acceptance Criteria\n\n- [ ] Common retry logic extracted\n- [ ] async_wrapper uses helper functions\n- [ ] sync_wrapper uses helper functions\n- [ ] Tests still pass\n- [ ] No behavior change (just refactor)","status":"closed","priority":3,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-24T20:10:24.232062Z","created_by":"spm1001","updated_at":"2026-01-24T20:34:20.265849Z","closed_at":"2026-01-24T20:34:20.265849Z","close_reason":"Won't do — code already well-factored. Helpers (_should_retry, _calculate_wait_with_jitter, _convert_to_mise_error) already extracted. Remaining duplication is irreducible async/sync split. Further extraction would add complexity for minimal benefit.","dependencies":[{"issue_id":"mise-v79","depends_on_id":"mise-52d","type":"parent-child","created_at":"2026-01-24T20:10:46.867102Z","created_by":"spm1001"},{"issue_id":"mise-v79","depends_on_id":"mise-4h4","type":"parent-child","created_at":"2026-01-24T20:17:04.665214Z","created_by":"spm1001"},{"issue_id":"mise-v79","depends_on_id":"mise-k6g","type":"blocks","created_at":"2026-01-24T20:18:14.898795Z","created_by":"spm1001"},{"issue_id":"mise-v79","depends_on_id":"mise-gtg","type":"blocks","created_at":"2026-01-24T20:18:14.988181Z","created_by":"spm1001"}]}
{"id":"mise-x2r","title":"Add logging to extractors","description":"Extractors are pure functions with zero visibility. When extraction fails silently or produces garbage, no trace of what happened. Add key log points: DEBUG for processing counts, WARNING for unknown elements or truncation.","status":"closed","priority":2,"issue_type":"task","owner":"spm1001@users.noreply.github.com","created_at":"2026-01-23T14:50:12.392463Z","created_by":"spm1001","updated_at":"2026-01-23T17:51:06.062342Z","closed_at":"2026-01-23T17:51:06.062342Z","close_reason":"Added warnings field to models (SpreadsheetData, DocData, GmailThreadData, PresentationData, FetchResult). Extractors now populate warnings for: truncation, empty sheets, unknown element types, missing inline objects, HTML conversion fallback, empty message bodies. Warnings bubble up via data.warnings for manifest.json. Inline messages remain in content for immediate visibility. 160 tests pass, mypy clean."}
